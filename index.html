<!DOCTYPE html>
<html>
	<head>
		<title>Pick and Recycle - Government View</title>
		<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/css/bootstrap.min.css" integrity="sha384-1q8mTJOASx8j1Au+a5WDVnPi2lkFfwwEAa8hDDdjZlpLegxhjVME1fgjWPGmkzs7" crossorigin="anonymous">
		<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/css/bootstrap-theme.min.css" integrity="sha384-fLW2N01lMqjakBkx3l/M9EahuwpSfeNvV63J5ezn3uZzapT0u7EYsXMjQV+0En5r" crossorigin="anonymous">
		<link href = "style.css" rel = "stylesheet">
		<script async defer
	      src="https://maps.googleapis.com/maps/api/js?key=AIzaSyDyurQ6pZCcR6UkmkTnqAOq8rChZBbOOs4&callback=initMap">
	    </script>
	    <script src="https://code.jquery.com/jquery-1.11.3.js"></script>
		<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/js/bootstrap.min.js" integrity="sha384-0mSbJDEHialfmuBBQP6A4Qrprq5OVfW37PRR3j5ELqxss1yVqOtnepnHVP9aJ7xS" crossorigin="anonymous"></script>   
	</head>
  	<body>
	  	<div class = "row">
		    <div id="map" class = "col-lg-8"></div>
		    <div id = "sidebar" class = "text-center" "col-lg-4">
			    <img id = "icon" src = "pickleicon.png" width="100" height="100">
			    <div id = "sidebartext">
				    <h1> Pick and Recycle </h1>
				    <h2> Government view </h2>
				    <hr>
			    </div>
		    </div>
	  		</div>
	  	</div>
	    <script type="text/javascript">

		    var locations = [];
		    
		    // Data for the markers consisting of a name, a LatLng and a zIndex for the
			// order in which these markers should display on top of each other.
			var xmlhttp = new XMLHttpRequest();
		  	var url = "http://104.155.237.238:8080/trash/";
		  	var latitude;
		  	var longitude;
		  	var description;
		  	var contentString;
		  	var listString = [];
		  	var photo;
		  	xmlhttp.onreadystatechange = function() {
			  	if (xmlhttp.readyState == 4 && xmlhttp.status == 200) {
				  	var myArr = JSON.parse(xmlhttp.responseText);
				  	myFunction(myArr);
				}
			};
			xmlhttp.open("GET", url, true);
			xmlhttp.send();
			
			function myFunction(arr) {
			    var result = arr.result;
			    for(i = 0; i<result.length; i++){
			    	if(result[i].report){
				    	latitude = result[i].latitude;
					    longitude = result[i].longitude;
					    description = result[i].description;
					    photo = result[i].photo_url;
					    console.log(latitude);
					    console.log(longitude);
					    console.log(description);
					    console.log(photo);
					    contentString = 
						'<div id = "content" class = "text-center">'+
						'<img src=\"' + photo + '\" width=\"100\" height=\"150\">' + '<br>' +
						'<p>' + description +'</p>'+
						'</div>'
						;
						listString.push(contentString);
					    locations.push([description,parseFloat(latitude),parseFloat(longitude),i+1]);
			    	}
			    }
				initMap();
			}
	
			function initMap() {
				
			var styles = [
			  {
			    featureType: "all",
			    stylers: [
				  { hue : "#00B5B5" },
			      { saturation: -50 }
			    ]
			  },{
			    featureType: "road.arterial",
			    elementType: "geometry",
			    stylers: [
			      { hue: "#F1654C" },
			      { saturation: 50 }
			    ]
			  },{
			    featureType: "poi.business",
			    elementType: "labels",
			    stylers: [
			      { visibility: "off" }
			    ]
			  }
			];
			
			var styledMap = new google.maps.StyledMapType(styles,{name: "Styled Map"});
    
			var map = new google.maps.Map(document.getElementById('map'), {
			  zoom: 11,
			  center: {lat: -6.207688,lng: 106.845552},
			  mapTypeControlOptions: {
			      mapTypeIds: [google.maps.MapTypeId.ROADMAP, 'map_style']
			  }
			});
			map.mapTypes.set('map_style', styledMap);
			map.setMapTypeId('map_style');
			setMarkers(map);
			
			var infowindow = new google.maps.InfoWindow({
			  content: contentString
			});
			
			function setMarkers(map) {
			  for (var i = 0; i < locations.length; i++) {
			    var report = locations[i];
			    var marker = new google.maps.Marker({
			      position: {lat: report[1], lng: report[2]},
			      map: map,
			      title: report[0],
			      zIndex: report[3],
			      animation: google.maps.Animation.DROP
			    });
			    google.maps.event.addListener(marker,'click', (function(marker, i) {
		            return function() {
		                infowindow.setContent(listString[i]);
		                infowindow.open(map, marker);
		            }
		        })(marker, i));
			  }
			}
			}
	    </script>
  	</body>
</html>